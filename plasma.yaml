impl: 'https://github.com/blend-os/tracks/raw/main'
track: 'blendos-base'

# Tolga Erok
# 11/8/25

packages:
# ðŸ–¥ï¸ Desktop & KDE
- 'kcoreaddons'
- 'kde-system-meta'
- 'kde-utilities-meta'
- 'plasma'
- 'plasma-workspace'
- 'sddm'
- 'systemsettings'

# ðŸŒ Akondai Related
- 'kaccounts-integration'
- 'kactivitymanagerd'
- 'kdepim-addons'
- 'kdepim-runtime'
- 'korganizer'

# ðŸŽ¨ Theming and Visuals
- 'breeze'
- 'plasma-workspace'
# - 'kde-wallpapers'

# ðŸ“‚ File System and Media Support
- 'kio-extras' # Provides various KIO slaves
- 'baloo' # File indexing and search
- 'baloo-widgets'
# - 'phonon-qt5' # Multimedia framework
# - 'phonon-qt5-vlc' # VLC backend for phonon

# ðŸ–¥ï¸ Virtualization & Containers
- 'virt-manager'
- 'waydroid'
- 'flatpak'

# ðŸ“ Spell check support
- 'aspell'
- 'aspell-en'
- 'hunspell'
- 'hunspell-en_au'

# ðŸŽ¨ Fonts
- 'gnu-free-fonts'
- 'nerd-fonts'
- 'noto-fonts-emoji'
- 'ttf-arphic-uming'
- 'ttf-firacode-nerd'
- 'ttf-font-awesome'
- 'ttf-indic-otf'

# ðŸŽžï¸ Multimedia & Graphics
# - 'rygel'
- 'ffmpeg'
- 'ffmpeg4.4'
- 'ffmpegthumbnailer'
- 'ffmpegthumbs'
- 'kcodecs'
- 'mpv'

# ðŸŽ® NVIDIA & GPU Support
- 'nvidia-dkms'
- 'nvidia-prime'
- 'nvidia-settings'
- 'nvidia-utils'
- 'switcheroo-control'

# ðŸŒ Networking & File Sharing
- 'samba'
# - 'waydroid'
# - 'waydroid-image'
- 'wget'
- 'wsdd'

# ðŸ”§ Core Utilities
# - 'notify-send-py'
# - 'pipxu'
# - 'python-pipx-git'
# - 'python-pipx'
- 'arch-install-scripts'
- 'archlinux-keyring'
- 'b43-fwcutter'
- 'base-devel'
- 'bash'
- 'bzip2'
- 'coreutils'
- 'fakeroot'
- 'fastfetch'
- 'ffmpeg'
- 'file'
- 'filesystem'
- 'filesystem-blend'
- 'findutils'
- 'firefox'
- 'git'
- 'sudo'
- 'sysfsutils'
- 'syslinux'
- 'systemd'
- 'systemd-libs'
- 'systemd-resolvconf'
- 'systemd-sysvcompat'
- 'which'
- 'zram-generator'
- 'zstd'
- 'konsole'

# ðŸ“¦ Development & Packaging
- 'python-pyqt5'

# ðŸ” Qt Frameworks
- 'qt5-base'
- 'qt5-declarative'
- 'qt5-svg'
- 'qt5-translations'
- 'qt5-wayland'
- 'qt5-x11extras'
- 'qt6-5compat'
- 'qt6-base'
- 'qt6-declarative'
- 'qt6-imageformats'
- 'qt6-multimedia'
- 'qt6-multimedia-ffmpeg'
- 'qt6-positioning'
- 'qt6-sensors'
- 'qt6-shadertools'
- 'qt6-speech'
- 'qt6-svg'
- 'qt6-tools'
- 'qt6-translations'
- 'qt6-virtualkeyboard'
- 'qt6-wayland'
- 'qt6-webchannel'
- 'qt6-webengine'
- 'qt6-websockets'

# ðŸ“‚ Filesystem Tools
- 'fuse-common'
- 'fuse2'
- 'fuse3'

# ðŸ–¨ï¸ Printing
- 'system-config-printer'

# ðŸ› ï¸ Fun & Terminal Eye Candy
- 'cmatrix'
- 'figlet'
- 'fortune-mod'
- 'lolcat'

# ðŸ› ï¸ Misc GUI Tools
- 'variety'
- 'yad'

# ðŸ“¦ Additional AUR Packages
aur-packages:
- 'notify-send-py'
- 'pipxu'
- 'python-pipx-git'
- 'visual-studio-code-bin'

- 'phonon-qt5-vlc'
- 'phonon-qt6-mpv' 
- 'phonon-qt5-mpv'
- 'phonon-qt5'

- 'linutil-bin'
- 'qemu-full'
- 'waydroid-image-gapps'
- 'quickemu'
- 'quickgui-bin'
- 'visual-studio-code-bin'
- 'google-chrome'

- 'nomacs'
- 'xnviewmp'

package-repos:
- name: 'chaotic-aur'
  repo-url: 'https://cdn-mirror.chaotic.cx/$repo/$arch'
- name: 'cachyos'
  repo-url: 'https://mirror.cachyos.org/repo/$arch/$repo/'

services:
# ðŸ–¨ï¸ Printing
- 'cups'

# ðŸŒ Networking & File Sharing
- 'NetworkManager'
- 'smb'
- 'nmb'
- 'wsdd'
- 'switcheroo-control'

# ðŸŽ® NVIDIA
- 'nvidia-persistenced'

# ðŸ–¥ï¸ Display/Login
- 'sddm'

# âš™ï¸ Custom Scripts
- 'set-mq-deadline'

- 'libvirtd'
- 'libvirt-storaged'

# ðŸ› ï¸ Add Nvidia option NVReg options
#system:
files:
  /etc/modprobe.d/nvidia.conf: |
    options nvidia NVreg_DynamicPowerManagement=0 NVreg_EnableMSI=1 NVreg_EnablePCIERelaxedOrderingMode=1 NVreg_EnablePCIeGen3=1 NVreg_EnableResizableBar=1 NVreg_EnableStreamMemOPs=1 NVreg_PreserveVideoMemoryAllocations=1 NVreg_UsePageAttributeTable=1 NVreg_TemporaryFilePath="/var/tmp" NVreg_RegistryDwords="RMIntrLockingMode=1; OverrideMaxPerf=0x1; PowerMizerEnable=0x1; RmPpmPolicy=0x1"
    options nvidia_drm modeset=1

commands:
# Rebuild initramfs so modprobe options take effect at boot
- 'mkinitcpio -P'

#  - 'curl -sSL https://raw.githubusercontent.com/tohurtv/blend-update/main/install.sh | bash -s -- "Mon,Fri 12:00"'

# Configuration commands (removed GNOME-specific cleanup)
- 'groupadd -f libvirt'
- 'useradd -r -s /sbin/nologin libvirt-qemu 2>/dev/null || true'
- 'usermod -aG kvm,libvirt libvirt-qemu'
- 'usermod -aG libvirt "$(whoami)"'
- 'pacman --noconfirm -Rns cups'
  
# Set locale to Autralia
- 'locale-gen en_AU.UTF-8'
- 'localedef -i en_AU -f UTF-8 en_AU.UTF-8'

# Install scloud downnloader
- 'pipxu install git+https://github.com/flyingrub/scdl'

# From original YAML on system
- 'rm -f /usr/share/applications/Waydroid.desktop'

# Add myself to admin   hint: sudo -i
- 'usermod -aG wheel tolga'

# Enable added services
- 'systemctl enable smb nmb wsdd'

# Enable NVIDIA persistencd
- 'systemctl enable --now nvidia-persistenced.service'

# Enable fstrim timer && trim ssd now
- 'fstrim -v / && fstrim -v /home || true'
- 'systemctl enable --now fstrim.timer'

# Create the SSD scheduler script, kingtolga style
- |
  cat > /usr/local/bin/set-mq-deadline.sh <<'EOF'
  #!/bin/bash
  # Tolga Erok
  # 8/8/25

  for dev in /sys/block/*; do
    if [ -f "$dev/queue/rotational" ] && [ "$(cat "$dev/queue/rotational")" -eq 0 ]; then
      # Check if device is NVMe
      if [[ "$(basename "$dev")" == nvme* ]]; then
        # NVMe: set scheduler to none
        echo none > "$dev/queue/scheduler" 2>/dev/null || true
      else
        # SSD (non-NVMe): set scheduler to mq-deadline
        echo mq-deadline > "$dev/queue/scheduler" 2>/dev/null || true
      fi
    fi
  done
  EOF
- 'chmod +x /usr/local/bin/set-mq-deadline.sh'

# Create systemd service to run my script once at boot
- |
  cat > /etc/systemd/system/set-mq-deadline.service <<'EOF'
  [Unit]
  Description=Set mq-deadline scheduler for SSDs, kingtolga style
  After=multi-user.target

  [Service]
  Type=oneshot
  ExecStart=/usr/local/bin/set-mq-deadline.sh

  [Install]
  WantedBy=multi-user.target
  EOF

# Enable the systemd service so it runs at boot! Lets see if this works
- 'systemctl enable set-mq-deadline.service'

# Show current I/O scheduler setup in build logs for visibility, (BETA):  journalctl -t io-scheduler -n 20
- |
  systemd-cat -t io-scheduler bash -c ' \
  echo "=== Storage Devices and I/O Schedulers ==="; \
  for dev in /sys/block/*; do \
    [ -f "$dev/queue/rotational" ] || continue; \
    rot=$(cat "$dev/queue/rotational"); \
    type=$([ "$rot" -eq 0 ] && echo "SSD/NVMe" || echo "HDD"); \
    echo "$(basename "$dev"): $type | Scheduler: $(cat "$dev/queue/scheduler")"; \
  done; \
  echo "=========================================="; \
  '
