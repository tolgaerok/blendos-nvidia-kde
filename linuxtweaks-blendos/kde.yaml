impl: 'https://github.com/blend-os/tracks/raw/main'
track: 'blendos-base'

packages:
  - 'nvidia-dkms'
  - 'nvidia-utils'
  - 'nvidia-settings'
  - 'switcheroo-control'

  - 'plasma'
  - 'plasma-workspace'
  - 'sddm'
  - 'kde-system-meta'
  - 'kde-utilities-meta'

  - 'kaccounts-integration'
  - 'kactivitymanagerd'
  - 'kdepim-addons'
  - 'aspell'
  - 'aspell-en'
  - 'hunspell'
  - 'hunspell-en_au'

  - 'gnu-free-fonts'
  - 'nerd-fonts'
  - 'noto-fonts-emoji'
  - 'ttf-firacode-nerd'

  - 'ffmpeg'
  - 'mpv'

aur-packages:
  - 'notify-send-py'
  - 'pipxu'
  - 'python-pipx-git'
  - 'visual-studio-code-bin'

package-repos:
  - name: 'chaotic-aur'
    repo-url: 'https://cdn-mirror.chaotic.cx/$repo/$arch'
  - name: 'cachyos'
    repo-url: 'https://mirror.cachyos.org/repo/$arch/$repo/'

services:
  - 'sddm'
  - 'nvidia-persistenced'
  - 'cups'
  - 'NetworkManager'
  - 'smb'
  - 'nmb'
  - 'wsdd'
  - 'switcheroo-control'

commands:
  - 'systemctl enable sddm'
  - 'systemctl enable --now nvidia-persistenced.service'
  - 'systemctl enable smb nmb wsdd'

  - 'usermod -aG wheel tolga'

  - 'locale-gen en_AU.UTF-8'
  - 'localedef -i en_AU -f UTF-8 en_AU.UTF-8'

  - |
    cat > /usr/local/bin/set-mq-deadline.sh <<'EOF'
    #!/bin/bash
    for dev in /sys/block/*; do
      if [ -f "$dev/queue/rotational" ] && [ "$(cat "$dev/queue/rotational")" -eq 0 ]; then
        if [[ "$(basename "$dev")" == nvme* ]]; then
          echo none > "$dev/queue/scheduler" 2>/dev/null || true
        else
          echo mq-deadline > "$dev/queue/scheduler" 2>/dev/null || true
        fi
      fi
    done
    EOF
  - 'chmod +x /usr/local/bin/set-mq-deadline.sh'

  - |
    cat > /etc/systemd/system/set-mq-deadline.service <<'EOF'
    [Unit]
    Description=Set mq-deadline scheduler for SSDs, kingtolga style
    After=multi-user.target

    [Service]
    Type=oneshot
    ExecStart=/usr/local/bin/set-mq-deadline.sh

    [Install]
    WantedBy=multi-user.target
    EOF
  - 'systemctl enable set-mq-deadline.service'

  - 'fstrim -v / && fstrim -v /home || true'
  - 'systemctl enable --now fstrim.timer'

  - 'pipxu install git+https://github.com/flyingrub/scdl'

  - 'rm -f /usr/share/applications/Waydroid.desktop'
